<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>My Trading View</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <link rel="stylesheet" href="./static/style.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body class="mdl-color--grey-100">
    <div class="mdl-layout__content">
      <div class="mdl-grid">
        <div class="position__cards mdl-cell mdl-cell--3-col mdl-cell--12-col-tablet mdl-grid mdl-grid--no-spacing">
            <div class="position__last-price mdl-card mdl-shadow--2dp mdl-cell mdl-cell--12-col">
              <div class="mdl-card__title mdl-card--expand mdl-color--teal-300">
                <h2 class="mdl-card__title-text">{{market_price}}</h2>
              </div>
              <div class="mdl-card__supporting-text mdl-color-text--grey-600">
              <ul class="demo-list-item mdl-list">
                <li class="mdl-list__item">
                  <span class="list__key">レバレッジ</span>
                  <span class="list__value">{{position.leverage}}</span>
                </li>
                <li class="mdl-list__item">
                  <span class="list__key">ポジション</span>
                  <span class="list__value">{{position.current_qty}}</span>
                </li>
                <li class="mdl-list__item">
                  <span class="list__key">エントリー</span>
                  <span class="list__value">{{position.avg_entry_price}}</span>
                </li>
                <li class="mdl-list__item">
                  <span class="list__key">損益率</span>
                  <span class="list__value">{{position.unrealised_pnl}}</span>
                </li>
              </ul>
              </div>
            </div>

        </div>
        <div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--9-col mdl-cell--12-col-tablet mdl-grid">
          <!-- TradingView Widget BEGIN -->
          <div class="tradingview-widget-container tradingview">
            <div id="tradingview_78106"></div>
            <div class="tradingview-widget-copyright"><a href="https://jp.tradingview.com/symbols/BITMEX-XBT/" rel="noopener" target="_blank">TradingViewによる<span class="blue-text">XBT</span><span class="blue-text">チャート</span></a></div>
            <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
            <script type="text/javascript">
            new TradingView.widget(
            {
            "autosize": true,
            "symbol": "BITMEX:XBT",
            "interval": "60",
            "timezone": "Asia/Tokyo",
            "theme": "Light",
            "style": "1",
            "locale": "ja",
            "toolbar_bg": "#f1f3f6",
            "enable_publishing": false,
            "allow_symbol_change": true,
            "hideideas": true,
            "container_id": "tradingview_78106"
            }
            );
            </script>
          </div>
          <!-- TradingView Widget END -->
        </div>
        <div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--5-col mdl-cell--12-col-tablet mdl-grid mdl-grid--no-spacing">
          <div class="mdl-card mdl-shadow--2dp mdl-cell mdl-cell--12-col">
            <table class="mdl-data-table mdl-js-data-table">
              <thead>
                <tr>
                  <th class="mdl-data-table__cell--non-numeric">時間</th>
                  <th>残高</th>
                </tr>
              </thead>
              {% for h in history %}
                <tbody>
                  <tr>
                    <td class="mdl-data-table__cell--non-numeric">{{h['timestamp']}}</td>
                    <td>{{h['walletBalance']}} XBT</td>
                  </tr>
                </tbody>
              {% endfor %}
            </table>
          </div>
        </div>
        <div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--7-col mdl-cell--12-col-tablet mdl-grid">
          <canvas id="chart" width="400" height="300"></canvas>
          <script>
          data={{ data|safe }}
          labels=data.map(function(h){return h['timestamp'];});
          wallets=data.map(function(h){return h['walletBalance'];});
          new Chart(document.getElementById("chart"),
          {"type":"line","data":{"labels":labels,
          "datasets":[{"label":"Balance","data":wallets,
          "fill":false,"borderColor":"rgb(75, 192, 192)","lineTension":0.1}]},"options":{}});
          </script>
        </div>
      </div>
    </div>
  </body>
</html>
